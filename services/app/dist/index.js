(()=>{"use strict";var e={523:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(i(965));class s extends o.default{signup(e){return{id:e.id,email:e.email}}login(e,t){return{id:e.id,email:e.email,token:t}}}t.default=s},534:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function u(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,u)}a((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(i(122)),r=o(i(20)),u=o(i(523)),a=o(i(540));t.default=()=>{const e=new u.default,t=(0,a.default)();return{signup:(i,o,s)=>{n(void 0,void 0,void 0,(function*(){const n=new r.default(i),s=yield t.signup(n);o.status(200).send(e.signup(s))})).catch(s)},login:(i,o,r)=>{n(void 0,void 0,void 0,(function*(){const n=new s.default(i),r=yield t.login(n);o.status(200).send(e.login(r,"authentication token"))})).catch(r)}}}},122:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){const{email:t,password:i}=e.body;this._email=t,this._password=i}get email(){return this._email}get password(){return this._password}}},20:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(i(972));t.default=class{constructor(e){const{email:t,password:i}=e.body;if(!t)throw new o.default("emailを入力してください",422);if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(t))throw new o.default("emailはメールアドレス形式で入力してください",422);if(!i)throw new o.default("passwordを入力してください",422);if(i.length<3||i.length>255)throw new o.default("passwordは3文字以上255文字以下で入力してください",422);if(!/^[A-Za-z0-9]*$/.test(i))throw new o.default("passwordは英数字のみが使用できます",422);this._email=t,this._password=i}get email(){return this._email}get password(){return this._password}}},341:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,i,n){this.id=e,this.email=t,this.password=i,this.lineId=n}}},675:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function u(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,u)}a((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersDB=void 0;const s=i(690),r=o(i(972));!function(e){e.select=e=>n(this,void 0,void 0,(function*(){return yield s.Users.findAll({where:e})})),e.update=(e,t)=>n(this,void 0,void 0,(function*(){const i=yield s.Users.findOne({where:e});if(!i)throw new r.default("Users Not Found",404);return t.email&&(i.email=t.email),t.password&&(i.password=t.password),t.line_id&&(i.line_id=t.line_id),yield i.save()})),e.insert=e=>n(this,void 0,void 0,(function*(){if(!e.email||!e.password)throw new r.default("Argments Not Enough",404);const t={id:e.id,email:e.email,password:e.password,line_id:e.line_id},[i,n]=yield s.Users.findOrCreate({where:{id:e.id,email:e.email},defaults:t});if(!n)throw new r.default("Failed Insert Data",404);return i})),e.destroy=e=>n(this,void 0,void 0,(function*(){const t=yield s.Users.findOne({where:e});if(!t)throw new r.default("Users not Found",404);return yield t.destroy().catch((()=>{throw new r.default("Failed Delete Data",404)})),!0})),e.count=e=>n(this,void 0,void 0,(function*(){return yield s.Users.count({where:{email:e}})})),e.register=(t,i)=>n(this,void 0,void 0,(function*(){return yield e.insert({email:t,password:i})})),e.fetchByEmail=t=>n(this,void 0,void 0,(function*(){let i=yield e.select({email:t});if(!i)throw new r.default("user not found",404);return i})),e.updateByEmail=(t,i,o)=>n(this,void 0,void 0,(function*(){let n=yield e.update({id:t,email:i},o);if(!n)throw new r.default("user not found",404);return o.email&&(n.email=o.email),o.password&&(n.password=o.password),o.line_id&&(n.line_id=o.line_id),yield n.save()}))}(t.UsersDB||(t.UsersDB={}))},563:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(i(534));t.default=e=>{const t=e.Router(),i=(0,o.default)();return t.route("/").post(i.signup),t.route("/login").post(i.login),t}},540:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function u(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,u)}a((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(i(341));t.default=()=>({signup:e=>n(void 0,void 0,void 0,(function*(){return new s.default(-1,e.email)})),login:e=>n(void 0,void 0,void 0,(function*(){return new s.default(-1,e.email)}))})},280:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0});const n={server:{port:null!==(i=process.env.PORT)&&void 0!==i?i:3001,cors:{origin:"http://localhost:3000"}}};t.default=n},323:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(762),s=n(i(280)).default.server.port;o.listen(s,(()=>{console.info(`Listening at http://localhost:${s}`)}))},690:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Users=void 0;const o=i(496),s=n(i(332));class r extends o.Model{}t.Users=r,r.init({id:{type:o.DataTypes.INTEGER,primaryKey:!0,autoIncrement:!0,unique:!0,allowNull:!1},email:{type:o.DataTypes.STRING,unique:!0,allowNull:!1},password:{type:o.DataTypes.STRING,allowNull:!1},line_id:{type:o.DataTypes.INTEGER,allowNull:!0,defaultValue:null}},{tableName:"users",sequelize:s.default,freezeTableName:!0,timestamps:!1})},332:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=new(i(496).Sequelize)("myapp","user","password",{host:"mysql",dialect:"mysql"});n.authenticate().then((()=>{console.log("Success test connection")})).catch((e=>{console.log("Failure test connection",e)})),t.default=n},972:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class i extends Error{constructor(e,t=500){super(e),this.message=e,this.status=t}}t.default=i},965:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{error(e){return{message:e.message}}}},697:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(i(965));t.default=e=>{e.use(((e,t,i,n)=>{const s=e.status||500,r=new o.default;i.status(s).send(r.error(e))}))}},762:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function u(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,u)}a((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(i(860)),r=o(i(582)),u=o(i(280)),a=o(i(563)),l=o(i(697)),d=i(690),c=i(675),f=(0,s.default)();f.use(s.default.json()),f.use(s.default.urlencoded({extended:!1}));const p={origin:u.default.server.cors.origin,optionsSuccessStatus:200};f.use((0,r.default)(p)),f.use("/api/v1/users",(0,a.default)(s.default)),f.route("/db").get(((e,t,i)=>{n(void 0,void 0,void 0,(function*(){(yield c.UsersDB.select({id:5})).map((e=>{console.log("id: %d, email: %s",e.id,e.email)})),t.status(200).end()})).catch(i)})),f.route("/db/create").get(((e,t)=>n(void 0,void 0,void 0,(function*(){const e=yield d.Users.create({email:"test2@example.com",password:"Password"});console.log(e)})))),(0,l.default)(f),e.exports=f},582:e=>{e.exports=require("cors")},860:e=>{e.exports=require("express")},496:e=>{e.exports=require("sequelize")}},t={};!function i(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}(323)})();