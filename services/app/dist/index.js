(()=>{"use strict";var e={237:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(965)),s=n(231);class r extends i.default{list(e){return{icons:(0,s.toCamelCaseObject)(e)}}}t.default=r},206:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,u)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(237));t.default=()=>{const e=new s.default;return{list:(t,n,i)=>{o(void 0,void 0,void 0,(function*(){n.status(200).send(e.list([{id:1,category:"11",image_path:"niku.png"},{id:2,category:"22",image_path:"yasai.png"}]))})).catch(i)}}}},335:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(206));t.default=e=>{const t=e.Router(),n=(0,i.default)();return t.route("/icons").get(n.list),t}},482:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,u)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=()=>({add:(e,t,o)=>{n(void 0,void 0,void 0,(function*(){console.log(e.user),t.status(200).end()})).catch(o)}})},937:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(267)),s=o(n(482));t.default=e=>{const t=e.Router(),n=(0,s.default)();return t.route("/:userId/places").post(i.default,n.add),t}},523:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(965));class s extends i.default{signup(e){return{id:e.id,email:e.email}}login(e,t){return{id:e.id,email:e.email,token:t}}}t.default=s},534:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,u)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(785),r=i(n(122)),u=i(n(20)),a=i(n(523)),l=i(n(540));t.default=()=>{const e=new a.default,t=(0,l.default)();return{signup:(n,i,s)=>{o(void 0,void 0,void 0,(function*(){const o=new u.default(n),s=yield t.signup(o);i.status(200).send(e.signup(s))})).catch(s)},login:(n,i,u)=>{o(void 0,void 0,void 0,(function*(){const o=new r.default(n),u=yield t.login(o),a={id:u.id,email:u.email},l=(0,s.signToken)(a);i.status(200).send(e.login(u,l))})).catch(u)}}}},122:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(96);t.default=class{constructor(e){const{email:t,password:n}=e.body;this._email=t,this._password=n}get email(){return this._email}get password(){return this._password}comparePassword(e){return(0,o.compareSync)(this._password,e)}}},20:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(972)),s=n(96);t.default=class{constructor(e){const{email:t,password:n}=e.body;if(!t)throw new i.default("emailを入力してください",422);if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(t))throw new i.default("emailはメールアドレス形式で入力してください",422);if(!n)throw new i.default("passwordを入力してください",422);if(n.length<3||n.length>255)throw new i.default("passwordは3文字以上255文字以下で入力してください",422);if(!/^[A-Za-z0-9]*$/.test(n))throw new i.default("passwordは英数字のみが使用できます",422);this._email=t,this._password=n}get email(){return this._email}get password(){return(0,s.hashSync)(this._password,10)}}},341:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,n,o){this.id=e,this.email=t,this.password=n,this.lineId=o}}},675:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,u)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersDB=void 0;const s=n(690),r=i(n(972));!function(e){e.select=e=>o(this,void 0,void 0,(function*(){return yield s.Users.findAll({where:e})})),e.update=(e,t)=>o(this,void 0,void 0,(function*(){const n=yield s.Users.findOne({where:e});if(!n)throw new r.default("Users Not Found",404);return t.email&&(n.email=t.email),t.password&&(n.password=t.password),t.line_id&&(n.line_id=t.line_id),yield n.save()})),e.insert=e=>o(this,void 0,void 0,(function*(){if(!e.email||!e.password)throw new r.default("Argments Not Enough",404);const t={id:e.id,email:e.email,password:e.password,line_id:e.line_id},[n,o]=yield s.Users.findOrCreate({where:{email:e.email},defaults:t});if(!o)throw new r.default("Failed Insert Data",404);return n})),e.destroy=e=>o(this,void 0,void 0,(function*(){const t=yield s.Users.findOne({where:e});if(!t)throw new r.default("Users not Found",404);return yield t.destroy().catch((()=>{throw new r.default("Failed Delete Data",404)})),!0})),e.count=e=>o(this,void 0,void 0,(function*(){return yield s.Users.count({where:{email:e}})})),e.register=(t,n)=>o(this,void 0,void 0,(function*(){return yield e.insert({email:t,password:n})})),e.fetchByEmail=t=>o(this,void 0,void 0,(function*(){let n=yield e.select({email:t});if(!n)throw new r.default("user not found",404);return n})),e.updateByEmail=(t,n,i)=>o(this,void 0,void 0,(function*(){let o=yield e.update({id:t,email:n},i);if(!o)throw new r.default("user not found",404);return i.email&&(o.email=i.email),i.password&&(o.password=i.password),i.line_id&&(o.line_id=i.line_id),yield o.save()}))}(t.UsersDB||(t.UsersDB={}))},563:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(534));t.default=e=>{const t=e.Router(),n=(0,i.default)();return t.route("/").post(n.signup),t.route("/login").post(n.login),t}},540:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,u)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(972)),r=i(n(341)),u=n(675);t.default=()=>({signup:e=>o(void 0,void 0,void 0,(function*(){if((yield u.UsersDB.count(e.email))>=1)throw new s.default("そのメールアドレスはすでに登録されています",400);const t=yield u.UsersDB.register(e.email,e.password);return new r.default(t.id,t.email)})),login:e=>o(void 0,void 0,void 0,(function*(){const t=(yield u.UsersDB.fetchByEmail(e.email))[0];if(!e.comparePassword(t.password))throw new s.default("メールアドレスまたはパスワードが間違っています",401);return new r.default(t.id,e.email)}))})},280:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0});const o={server:{port:null!==(n=process.env.PORT)&&void 0!==n?n:3001,cors:{origin:"http://localhost:3000"}}};t.default=o},323:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(762),s=o(n(280)).default.server.port;i.listen(s,(()=>{console.info(`Listening at http://localhost:${s}`)}))},690:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Users=void 0;const i=n(496),s=o(n(332));class r extends i.Model{}t.Users=r,r.init({id:{type:i.DataTypes.INTEGER,primaryKey:!0,autoIncrement:!0,unique:!0,allowNull:!1},email:{type:i.DataTypes.STRING,unique:!0,allowNull:!1},password:{type:i.DataTypes.STRING,allowNull:!1},line_id:{type:i.DataTypes.INTEGER,allowNull:!0,defaultValue:null}},{tableName:"users",sequelize:s.default,freezeTableName:!0,timestamps:!1})},332:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=new(n(496).Sequelize)("myapp","user","password",{host:"mysql",dialect:"mysql"});o.authenticate().then((()=>{console.log("Success test connection")})).catch((e=>{console.log("Failure test connection",e)})),t.default=o},972:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class n extends Error{constructor(e,t=500){super(e),this.message=e,this.status=t}}t.default=n},965:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{error(e){return{message:e.message}}}},785:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.verifyToken=t.signToken=void 0;const i=o(n(344)),s=null!=="secret_key"?"secret_key":"my SECRET_KEY";t.signToken=e=>i.default.sign(e,s),t.verifyToken=e=>i.default.verify(e,s)},231:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toCamelCaseObject=t.toCamelCase=t.hasProperty=void 0,t.hasProperty=(e,...t)=>e instanceof Object&&t.every((t=>t in e)),t.toCamelCase=e=>e.split("_").map(((e,t)=>0===t?e.toLowerCase():e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(""),t.toCamelCaseObject=e=>{if(Array.isArray(e)){const n=[];return e.forEach((e=>{n.push((0,t.toCamelCaseObject)(e))})),n}{const n={};return Object.keys(e).forEach((o=>{n[(0,t.toCamelCase)(o)]=e[o]})),n}}},697:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(965));t.default=e=>{e.use(((e,t,n,o)=>{const s=e.status||500,r=new i.default;n.status(s).send(r.error(e))}))}},267:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.tokenVerify=void 0;const i=o(n(972)),s=n(785),r=n(231);t.tokenVerify=(e,t,n)=>{const o=e.headers.authorization;if(null==o)throw new i.default("Authorizationリクエストヘッダーがありません。",401);if("Bearer"!==o.split(" ")[0])throw new i.default("Authorizationリクエストヘッダーがありません。",401);const u=o.split(" ")[1];try{const t=(0,s.verifyToken)(u);if(!(0,r.hasProperty)(t,"id")||"number"!=typeof t.id)throw new i.default("トークンが間違っています",401);e.user={id:t.id},n()}catch(e){throw new i.default("認証に失敗しました。",401)}},t.default=t.tokenVerify},762:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(860)),s=o(n(582)),r=o(n(280)),u=o(n(563)),a=o(n(335)),l=o(n(697)),d=o(n(937)),c=(0,i.default)();c.use(i.default.json()),c.use(i.default.urlencoded({extended:!1}));const f={origin:r.default.server.cors.origin,optionsSuccessStatus:200};c.use((0,s.default)(f)),c.use("/api/v1/users",(0,u.default)(i.default)),c.use("/api/v1/foods",(0,d.default)(i.default)),c.use("/api/v1/foods",(0,a.default)(i.default)),(0,l.default)(c),e.exports=c},96:e=>{e.exports=require("bcrypt")},582:e=>{e.exports=require("cors")},860:e=>{e.exports=require("express")},344:e=>{e.exports=require("jsonwebtoken")},496:e=>{e.exports=require("sequelize")}},t={};!function n(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}(323)})();